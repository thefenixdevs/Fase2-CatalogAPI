apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-init-script
  namespace: catalogapi
  labels:
    app: postgres
data:
  init-db.sql: |
    -- Script de inicialização do banco de dados
    -- Este script é executado automaticamente quando o container PostgreSQL é criado pela primeira vez

    -- Garante que o banco de dados existe
    SELECT 'CREATE DATABASE catalogdb'
    WHERE NOT EXISTS (SELECT FROM pg_database WHERE datname = 'catalogdb')\gexec

    -- Conecta ao banco de dados catalogdb
    \c catalogdb

    -- Cria extensões úteis
    CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

    -- Confirma que o banco foi criado
    SELECT 'Database catalogdb initialized successfully' AS status;
